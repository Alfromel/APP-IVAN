<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游댮 TOKTOK - MONITOREO EN VIVO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* RESET Y VARIABLES */
        :root {
            --telegram-bg: #0e1621;
            --telegram-sidebar: #182533;
            --telegram-chat-bg: #0e1621;
            --telegram-message-bg: #182533;
            --telegram-message-out: #2b5278;
            --telegram-text: #e1e1e1;
            --telegram-text-secondary: #7a8a9d;
            --telegram-border: #1e2c3a;
            --telegram-hover: #2b5278;
            --telegram-active: #2b5278;
            --entel: #00A1E4;
            --tigo: #090780;
            --viva: #09a71e;
            --diamonds: #FFD700;
            --saldo: #00C853;
            --online: #00C853;
            --offline: #FF3D00;
            --warning: #FFAB00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--telegram-bg);
            color: var(--telegram-text);
            overflow: hidden;
            height: 100vh;
        }

        /* ESTRUCTURA TELEGRAM */
        .telegram-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* SIDEBAR IZQUIERDA - LISTA DE CHATS */
        .sidebar {
            width: 360px;
            background: var(--telegram-sidebar);
            border-right: 1px solid var(--telegram-border);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* HEADER SIDEBAR */
        .sidebar-header {
            padding: 20px 15px;
            background: var(--telegram-sidebar);
            border-bottom: 1px solid var(--telegram-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--telegram-text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--telegram-text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--offline);
        }

        .status-dot.online {
            background: var(--online);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* CONTROLES */
        .controls-panel {
            padding: 15px;
            background: var(--telegram-sidebar);
            border-bottom: 1px solid var(--telegram-border);
        }

        .search-box {
            position: relative;
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--telegram-border);
            border-radius: 20px;
            color: var(--telegram-text);
            font-size: 14px;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--entel);
            background: rgba(0,0,0,0.2);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--telegram-text-secondary);
        }

        .provider-filter {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 15px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--telegram-border);
            border-radius: 15px;
            color: var(--telegram-text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .filter-btn:hover {
            background: var(--telegram-hover);
            color: var(--telegram-text);
        }

        .filter-btn.active {
            background: var(--telegram-active);
            border-color: var(--entel);
            color: white;
        }

        .filter-btn.entel.active {
            background: var(--entel);
        }

        .filter-btn.tigo.active {
            background: var(--tigo);
            color: #000;
        }

        .filter-btn.viva.active {
            background: var(--viva);
        }

        .filter-btn.diamonds.active {
            background: var(--diamonds);
            color: #000;
        }

        .filter-btn.saldo.active {
            background: var(--saldo);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* LISTA DE GRUPOS */
        .groups-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
            background: var(--telegram-sidebar);
        }

        .group-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            position: relative;
        }

        .group-item:hover {
            background: rgba(255,255,255,0.05);
        }

        .group-item.active {
            background: var(--telegram-active);
        }

        .group-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            flex-shrink: 0;
            overflow: hidden;
        }

        .group-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .group-icon.entel {
            background: linear-gradient(135deg, var(--entel), #0077B6);
        }

        .group-icon.tigo {
            background: linear-gradient(135deg, var(--tigo), #CC9900);
        }

        .group-icon.viva {
            background: linear-gradient(135deg, var(--viva), #5E35B1);
        }

        .group-icon.diamonds {
            background: linear-gradient(135deg, var(--diamonds), #FF8C00);
        }

        .group-icon.saldo {
            background: linear-gradient(135deg, var(--saldo), #009688);
        }

        .group-info {
            flex: 1;
            min-width: 0;
        }

        .group-name {
            font-weight: 500;
            font-size: 15px;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .group-name span {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .message-count {
            background: var(--entel);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            min-width: 24px;
            text-align: center;
        }

        .group-status {
            font-size: 12px;
            color: var(--telegram-text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .group-status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--offline);
        }

        .group-status-dot.online {
            background: var(--online);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* PANEL PRINCIPAL - CHAT */
        .chat-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--telegram-chat-bg);
            position: relative;
        }

        /* HEADER DEL CHAT */
        .chat-header {
            padding: 15px 20px;
            background: var(--telegram-sidebar);
            border-bottom: 1px solid var(--telegram-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            overflow: hidden;
        }

        .chat-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .chat-icon.entel {
            background: linear-gradient(135deg, var(--entel), #0077B6);
        }

        .chat-icon.tigo {
            background: linear-gradient(135deg, var(--tigo), #CC9900);
        }

        .chat-icon.viva {
            background: linear-gradient(135deg, var(--viva), #5E35B1);
        }

        .chat-icon.diamonds {
            background: linear-gradient(135deg, var(--diamonds), #FF8C00);
        }

        .chat-icon.saldo {
            background: linear-gradient(135deg, var(--saldo), #009688);
        }

        .chat-info h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .chat-info p {
            font-size: 13px;
            color: var(--telegram-text-secondary);
        }

        .chat-stats {
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: var(--telegram-text-secondary);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--telegram-text);
            margin-bottom: 2px;
        }

        /* 츼REA DE MENSAJES */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--telegram-chat-bg);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* MENSAJES */
        .message {
            max-width: 75%;
            padding: 8px 12px;
            border-radius: 12px;
            background: var(--telegram-message-bg);
            position: relative;
            animation: slideIn 0.2s ease;
            border: 1px solid rgba(255,255,255,0.05);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.new {
            animation: highlight 1s ease;
        }

        @keyframes highlight {
            0% { 
                background: rgba(0,200,83,0.3);
                border-color: rgba(0,200,83,0.5);
            }
            100% { 
                background: var(--telegram-message-bg);
                border-color: rgba(255,255,255,0.05);
            }
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 12px;
        }

        .message-sender {
            font-weight: 600;
            color: var(--entel);
        }

        .message-time {
            color: var(--telegram-text-secondary);
            font-size: 11px;
        }

        .message-content {
            word-break: break-word;
            line-height: 1.4;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .keyword {
            background: rgba(255,204,0,0.2);
            padding: 1px 4px;
            border-radius: 3px;
            color: #FFCC00;
            font-weight: 500;
        }

        /* SIN CHAT SELECCIONADO */
        .no-chat-selected {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
            color: var(--telegram-text-secondary);
        }

        .no-chat-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .no-chat-selected h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--telegram-text);
        }

        /* LOADING SCREEN */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--telegram-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--telegram-border);
            border-top-color: var(--entel);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            font-size: 16px;
            color: var(--telegram-text-secondary);
            text-align: center;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* NOTIFICACIONES */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--telegram-sidebar);
            padding: 12px 16px;
            border-radius: 8px;
            border-left: 4px solid var(--entel);
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
            max-width: 300px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid var(--telegram-border);
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.2);
        }

        /* RESPONSIVE */
        @media (max-width: 900px) {
            .sidebar {
                width: 300px;
            }
            
            .chat-stats {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 768px) {
            .telegram-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 300px;
            }
            
            .chat-panel {
                height: calc(100vh - 300px);
            }
        }
    </style>
</head>
<body>
    <!-- Pantalla de carga -->
    <div id="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">Conectando con los servidores de Telegram...</div>
    </div>

    <!-- Contenedor principal estilo Telegram -->
    <div class="telegram-container">
        <!-- Sidebar izquierda -->
        <div class="sidebar">
            <!-- Header de la sidebar -->
            <div class="sidebar-header">
                <div class="sidebar-title">
                    <i class="fas fa-satellite-dish"></i>
                    TOKTOK MONITOR
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="connection-dot"></div>
                    <span id="status-text">Conectando...</span>
                </div>
            </div>

            <!-- Controles -->
            <div class="controls-panel">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="search-input" placeholder="Buscar grupos o mensajes...">
                </div>
                
                <div class="provider-filter">
                    <button class="filter-btn active" data-filter="all">
                        <i class="fas fa-layer-group"></i> TODOS
                    </button>
                    <button class="filter-btn entel" data-filter="entel">
                        <i class="fas fa-signal"></i> ENTEL
                    </button>
                    <button class="filter-btn tigo" data-filter="tigo">
                        <i class="fas fa-wifi"></i> TIGO
                    </button>
                    <button class="filter-btn viva" data-filter="viva">
                        <i class="fas fa-bolt"></i> VIVA
                    </button>
                    <button class="filter-btn diamonds" data-filter="diamonds">
                        <i class="fas fa-gem"></i> DIAMANTES
                    </button>
                    <button class="filter-btn saldo" data-filter="saldo">
                        <i class="fas fa-money-bill-wave"></i> SALDO
                    </button>
                </div>
                
                <div class="action-buttons">
                    <button class="filter-btn" id="refresh-btn">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                    <button class="filter-btn" id="clear-btn">
                        <i class="fas fa-trash"></i> Limpiar
                    </button>
                </div>
            </div>

            <!-- Lista de grupos -->
            <div class="groups-list" id="groups-list">
                <!-- Grupos se generan din치micamente -->
            </div>
        </div>

        <!-- Panel principal de chat -->
        <div class="chat-panel">
            <!-- Header del chat -->
            <div class="chat-header">
                <div class="chat-title">
                    <div class="chat-icon entel" id="active-chat-icon">
                        <i class="fas fa-satellite-dish"></i>
                    </div>
                    <div class="chat-info">
                        <h3 id="active-chat-name">Selecciona un grupo</h3>
                        <p id="active-chat-status">Estado del grupo</p>
                    </div>
                </div>
                
                <div class="chat-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="total-messages">0</div>
                        <div class="stat-label">MENSAJES</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="entel-count">10</div>
                        <div class="stat-label">ENTEL</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="tigo-count">5</div>
                        <div class="stat-label">TIGO</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="viva-count">5</div>
                        <div class="stat-label">VIVA</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="diamonds-count">1</div>
                        <div class="stat-label">DIAMANTES</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="saldo-count">1</div>
                        <div class="stat-label">SALDO</div>
                    </div>
                </div>
            </div>

            <!-- 츼rea de mensajes -->
            <div class="messages-area" id="messages-area">
                <!-- Mensaje cuando no hay chat seleccionado -->
                <div class="no-chat-selected" id="no-chat-selected">
                    <div class="no-chat-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3>Selecciona un grupo</h3>
                    <p>Haz clic en un grupo de la lista para ver los mensajes en tiempo real</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notificaciones -->
    <div class="notification" id="notification">
        <i class="fas fa-bell"></i>
        <div id="notification-text"></div>
    </div>

    <script>
        // CONFIGURACI칍N PRECISA DE TODOS LOS GRUPOS
        const CONFIG = {
            updateInterval: 2000, // 2 segundos
            maxMessagesPerGroup: 15,
            token: '7596286871:AAGFe3sHy-GhykyM_xsFwDU8qrt6SWXSWHY',
            groups: {
                entel: [
                    { id: 1, chatId: '-5097260004', name: 'ENTEL GRUPO 1' },
                    { id: 2, chatId: '-5095663519', name: 'ENTEL GRUPO 2' },
                    { id: 3, chatId: '-5016577571', name: 'ENTEL GRUPO 3' },
                    { id: 4, chatId: '-5029645589', name: 'ENTEL GRUPO 4' },
                    { id: 5, chatId: '-4990977767', name: 'ENTEL GRUPO 5' },
                    { id: 6, chatId: '-5041775747', name: 'ENTEL GRUPO 6' },
                    { id: 7, chatId: '-5065354897', name: 'ENTEL GRUPO 7' },
                    { id: 8, chatId: '-5091393285', name: 'ENTEL GRUPO 8' },
                    { id: 9, chatId: '-5058697299', name: 'ENTEL GRUPO 9' },
                    { id: 10, chatId: '-4890816539', name: 'ENTEL GRUPO 10' }
                ],
                tigo: [
                    { id: 1, chatId: '-4843757881', name: 'TIGO GRUPO 1' },
                    { id: 2, chatId: '-5077788894', name: 'TIGO GRUPO 2' },
                    { id: 3, chatId: '-5041267123', name: 'TIGO GRUPO 3' },
                    { id: 4, chatId: '-5021211004', name: 'TIGO GRUPO 4' },
                    { id: 5, chatId: '-5085496619', name: 'TIGO GRUPO 5' }
                ],
                viva: [
                    { id: 1, chatId: '-5059040889', name: 'VIVA GRUPO 1' },
                    { id: 2, chatId: '-5037389529', name: 'VIVA GRUPO 2' },
                    { id: 3, chatId: '-5084989527', name: 'VIVA GRUPO 3' },
                    { id: 4, chatId: '-5010950916', name: 'VIVA GRUPO 4' },
                    { id: 5, chatId: '-5084926883', name: 'VIVA GRUPO 5' }
                ],
                diamonds: [
                    { id: 1, chatId: '-4968186416', name: 'RECARGAS DE DIAMANTES' }
                ],
                saldo: [
                    { id: 1, chatId: '-4851584355', name: 'RECARGAS DE SALDO' }
                ]
            },
            images: {
                entel: 'https://media.licdn.com/dms/image/v2/C4E0BAQG1v59-bT48KQ/company-logo_200_200/company-logo_200_200/0/1630599269425?e=2147483647&v=beta&t=AY3Enby1qfJ-Jyk12-YuQboW9aV1llBQBNAL5zew_4Q',
                tigo: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSRRZs8_uJSszNDJTEW8rznS4sW5iGj171peg&s',
                viva: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRUuswazml5u5GPG1ND2SZ5SFrPPza_jVMdRg&s',
                diamonds: 'https://png.pngtree.com/png-vector/20190718/ourmid/pngtree-diamond-logo-template-png-image_1548443.jpg',
                saldo: 'https://static.vecteezy.com/system/resources/previews/016/744/612/non_2x/money-top-up-button-on-mobile-app-concept-illustration-flat-design-eps10-graphic-element-for-icon-infographic-empty-state-app-or-web-ui-vector.jpg'
            },
            keywords: [
                'recarga', 'saldo', 'transferencia', 'monto', 'confirmo',
                'banco', 'pago', 'dep칩sito', 'referencia', 'operaci칩n',
                'activaci칩n', 'paquete', 'promoci칩n', 'bonificaci칩n', 'servicio'
            ]
        };

        // ESTADO DE LA APLICACI칍N
        const state = {
            messages: {},
            stats: {
                total: 0,
                entel: 0,
                tigo: 0,
                viva: 0,
                diamonds: 0,
                saldo: 0,
                lastUpdate: null,
                connectedGroups: 0,
                totalGroups: 22
            },
            filters: {
                provider: 'all',
                search: ''
            },
            intervals: {},
            lastUpdateId: 0,
            isConnected: false,
            activeGroup: null
        };

        // ELEMENTOS DOM
        const elements = {
            loadingScreen: document.getElementById('loading-screen'),
            loadingText: document.getElementById('loading-text'),
            connectionDot: document.getElementById('connection-dot'),
            statusText: document.getElementById('status-text'),
            groupsList: document.getElementById('groups-list'),
            searchInput: document.getElementById('search-input'),
            notification: document.getElementById('notification'),
            notificationText: document.getElementById('notification-text'),
            totalMessages: document.getElementById('total-messages'),
            entelCount: document.getElementById('entel-count'),
            tigoCount: document.getElementById('tigo-count'),
            vivaCount: document.getElementById('viva-count'),
            diamondsCount: document.getElementById('diamonds-count'),
            saldoCount: document.getElementById('saldo-count'),
            activeChatName: document.getElementById('active-chat-name'),
            activeChatStatus: document.getElementById('active-chat-status'),
            activeChatIcon: document.getElementById('active-chat-icon'),
            messagesArea: document.getElementById('messages-area'),
            noChatSelected: document.getElementById('no-chat-selected'),
            filterButtons: document.querySelectorAll('.filter-btn'),
            refreshBtn: document.getElementById('refresh-btn'),
            clearBtn: document.getElementById('clear-btn')
        };

        // INICIALIZAR APLICACI칍N
        async function init() {
            // Inicializar estructura de mensajes
            Object.keys(CONFIG.groups).forEach(provider => {
                CONFIG.groups[provider].forEach(group => {
                    const key = `${provider}-${group.id}`;
                    state.messages[key] = [];
                });
            });
            
            // Renderizar lista de grupos
            renderGroupsList();
            
            // Iniciar monitoreo
            await startMonitoring();
            
            // Ocultar loading
            setTimeout(() => {
                elements.loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    elements.loadingScreen.style.display = 'none';
                }, 500);
            }, 1000);
            
            setupEventListeners();
        }

        // RENDERIZAR LISTA DE GRUPOS
        function renderGroupsList() {
            elements.groupsList.innerHTML = '';
            
            Object.keys(CONFIG.groups).forEach(provider => {
                CONFIG.groups[provider].forEach(group => {
                    const groupItem = createGroupListItem(provider, group);
                    elements.groupsList.appendChild(groupItem);
                });
            });
        }

        // CREAR ITEM DE GRUPO EN LISTA
        function createGroupListItem(provider, group) {
            const item = document.createElement('div');
            item.className = 'group-item';
            item.dataset.provider = provider;
            item.dataset.groupId = group.id;
            item.id = `group-item-${provider}-${group.id}`;
            
            const iconClass = provider === 'entel' ? 'fa-signal' : 
                            provider === 'tigo' ? 'fa-wifi' : 
                            provider === 'viva' ? 'fa-bolt' :
                            provider === 'diamonds' ? 'fa-gem' : 'fa-money-bill-wave';
            
            item.innerHTML = `
                <div class="group-icon ${provider}">
                    ${provider === 'diamonds' || provider === 'saldo' || provider === 'entel' || provider === 'tigo' || provider === 'viva' ? 
                        `<img src="${CONFIG.images[provider]}" alt="${provider}" onerror="this.onerror=null; this.parentElement.innerHTML='<i class=\"fas ${iconClass}\"></i>';" />` : 
                        `<i class="fas ${iconClass}"></i>`
                    }
                </div>
                <div class="group-info">
                    <div class="group-name">
                        <span>${group.name}</span>
                        <div class="message-count" id="count-${provider}-${group.id}">0</div>
                    </div>
                    <div class="group-status">
                        <div class="group-status-dot"></div>
                        <span>Esperando conexi칩n...</span>
                    </div>
                </div>
            `;
            
            // Agregar evento click
            item.addEventListener('click', () => {
                setActiveGroup(provider, group.id);
            });
            
            return item;
        }

        // ESTABLECER GRUPO ACTIVO
        function setActiveGroup(provider, groupId) {
            const key = `${provider}-${groupId}`;
            state.activeGroup = { provider, groupId };
            
            // Remover clase active de todos los items
            document.querySelectorAll('.group-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Agregar clase active al item seleccionado
            const activeItem = document.getElementById(`group-item-${provider}-${groupId}`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            // Actualizar header del chat
            const group = CONFIG.groups[provider].find(g => g.id == groupId);
            elements.activeChatName.textContent = group.name;
            elements.activeChatStatus.textContent = 'Conectado - Monitoreando en tiempo real';
            
            // Actualizar icono
            elements.activeChatIcon.className = `chat-icon ${provider}`;
            const iconClass = provider === 'entel' ? 'fa-signal' : 
                            provider === 'tigo' ? 'fa-wifi' : 
                            provider === 'viva' ? 'fa-bolt' :
                            provider === 'diamonds' ? 'fa-gem' : 'fa-money-bill-wave';
            
            elements.activeChatIcon.innerHTML = `
                ${provider === 'diamonds' || provider === 'saldo' || provider === 'entel' || provider === 'tigo' || provider === 'viva' ? 
                    `<img src="${CONFIG.images[provider]}" alt="${provider}" onerror="this.onerror=null; this.innerHTML='<i class=\"fas ${iconClass}\"></i>';" />` : 
                    `<i class="fas ${iconClass}"></i>`
                }
            `;
            
            // Ocultar placeholder y mostrar mensajes
            elements.noChatSelected.style.display = 'none';
            
            // Renderizar mensajes del grupo activo
            renderActiveGroupMessages(provider, groupId);
        }

        // RENDERIZAR MENSAJES DEL GRUPO ACTIVO
        function renderActiveGroupMessages(provider, groupId) {
            const key = `${provider}-${groupId}`;
            const messages = state.messages[key] || [];
            
            elements.messagesArea.innerHTML = '';
            
            if (messages.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'no-chat-selected';
                emptyMessage.innerHTML = `
                    <div class="no-chat-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3>No hay mensajes a칰n</h3>
                    <p>Los mensajes aparecer치n aqu칤 en tiempo real</p>
                `;
                elements.messagesArea.appendChild(emptyMessage);
                return;
            }
            
            // Ordenar mensajes por fecha (m치s reciente primero)
            const sortedMessages = [...messages].sort((a, b) => b.date - a.date);
            
            sortedMessages.forEach(message => {
                const messageElement = createMessageElement(message);
                elements.messagesArea.appendChild(messageElement);
            });
            
            // Aplicar filtros de b칰squeda si existen
            applyFilters();
        }

        // CREAR ELEMENTO DE MENSAJE
        function createMessageElement(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.dataset.timestamp = message.date;
            
            // Formatear hora
            const time = new Date(message.date * 1000).toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // Formatear contenido con keywords destacadas
            let content = message.text || '[Mensaje sin texto]';
            CONFIG.keywords.forEach(keyword => {
                const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
                content = content.replace(regex, `<span class="keyword">$&</span>`);
            });
            
            messageElement.innerHTML = `
                <div class="message-header">
                    <div class="message-sender">
                        ${message.from?.first_name || 'Usuario'}
                    </div>
                    <div class="message-time">${time}</div>
                </div>
                <div class="message-content">${content}</div>
            `;
            
            return messageElement;
        }

        // INICIAR MONITOREO
        async function startMonitoring() {
            updateLoadingText('Conectando con servidores de Telegram...');
            
            // Probar conexi칩n inicial
            const isConnected = await testConnection();
            
            if (isConnected) {
                setConnectionStatus(true);
                updateLoadingText('Conexi칩n establecida. Iniciando monitoreo...');
                
                // Iniciar monitoreo de todos los grupos
                Object.keys(CONFIG.groups).forEach(provider => {
                    CONFIG.groups[provider].forEach(group => {
                        startGroupMonitoring(provider, group);
                    });
                });
                
                showNotification('Sistema de monitoreo iniciado', 'success');
            } else {
                setConnectionStatus(false);
                updateLoadingText('Error de conexi칩n. Reintentando...');
                setTimeout(startMonitoring, 5000);
            }
        }

        // PROBAR CONEXI칍N
        async function testConnection() {
            try {
                const response = await fetch(`https://api.telegram.org/bot${CONFIG.token}/getMe`, {
                    signal: AbortSignal.timeout(5000)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.ok === true;
                }
                return false;
            } catch (error) {
                console.error('Error de conexi칩n:', error);
                return false;
            }
        }

        // MONITOREAR GRUPO ESPEC칈FICO
        function startGroupMonitoring(provider, group) {
            const key = `${provider}-${group.id}`;
            
            // Funci칩n de actualizaci칩n
            const updateGroup = async () => {
                try {
                    const response = await fetch(
                        `https://api.telegram.org/bot${CONFIG.token}/getUpdates?offset=${state.lastUpdateId}&timeout=5`
                    );
                    
                    if (!response.ok) throw new Error('Error HTTP');
                    
                    const data = await response.json();
                    
                    if (data.ok && data.result && data.result.length > 0) {
                        processUpdates(provider, group, data.result);
                        updateGroupStatus(provider, group.id, true);
                    } else {
                        updateGroupStatus(provider, group.id, false);
                    }
                    
                } catch (error) {
                    updateGroupStatus(provider, group.id, false);
                }
            };
            
            // Ejecutar inmediatamente
            updateGroup();
            
            // Configurar intervalo
            state.intervals[key] = setInterval(updateGroup, CONFIG.updateInterval);
        }

        // PROCESAR ACTUALIZACIONES
        function processUpdates(provider, group, updates) {
            const groupMessages = updates.filter(update => 
                update.message?.chat?.id == group.chatId
            );
            
            if (groupMessages.length === 0) return;
            
            // Actualizar 칰ltimo update_id
            const lastUpdate = updates[updates.length - 1];
            state.lastUpdateId = Math.max(state.lastUpdateId, lastUpdate.update_id + 1);
            
            // Procesar cada mensaje
            groupMessages.forEach(update => {
                addMessage(provider, group.id, update.message);
            });
            
            state.stats.lastUpdate = new Date();
        }

        // AGREGAR MENSAJE
        function addMessage(provider, groupId, message) {
            const key = `${provider}-${groupId}`;
            const messageKey = `${message.message_id}-${message.date}`;
            
            // Evitar duplicados
            if (state.messages[key].some(m => 
                `${m.message_id}-${m.date}` === messageKey
            )) {
                return;
            }
            
            // Preparar mensaje
            const processedMessage = {
                ...message,
                provider: provider,
                groupId: groupId,
                processedAt: Date.now()
            };
            
            // Agregar al inicio
            state.messages[key].unshift(processedMessage);
            
            // Mantener l칤mite
            if (state.messages[key].length > CONFIG.maxMessagesPerGroup) {
                state.messages[key].pop();
            }
            
            // Actualizar estad칤sticas
            updateStatistics(provider);
            
            // Actualizar contador de grupo
            updateGroupCount(provider, groupId);
            
            // Si este es el grupo activo, renderizar el mensaje
            if (state.activeGroup && 
                state.activeGroup.provider === provider && 
                state.activeGroup.groupId == groupId) {
                const messageElement = createMessageElement(processedMessage);
                messageElement.classList.add('new');
                
                // Insertar al inicio del 치rea de mensajes
                if (elements.messagesArea.firstChild) {
                    elements.messagesArea.insertBefore(messageElement, elements.messagesArea.firstChild);
                } else {
                    elements.messagesArea.appendChild(messageElement);
                }
            }
            
            // Mostrar notificaci칩n para mensajes nuevos
            if (Date.now() - message.date * 1000 < 10000) { // Mensaje de 칰ltimos 10 segundos
                showNewMessageNotification(provider, groupId, message);
            }
        }

        // ACTUALIZAR ESTAD칈STICAS
        function updateStatistics(provider) {
            state.stats[provider]++;
            state.stats.total++;
            
            // Actualizar UI
            elements[`${provider}Count`].textContent = CONFIG.groups[provider].length;
            elements.totalMessages.textContent = state.stats.total;
        }

        // ACTUALIZAR CONTADOR DE GRUPO
        function updateGroupCount(provider, groupId) {
            const key = `${provider}-${groupId}`;
            const count = state.messages[key]?.length || 0;
            const countElement = document.getElementById(`count-${provider}-${groupId}`);
            if (countElement) {
                countElement.textContent = count;
            }
        }

        // ACTUALIZAR ESTADO DE GRUPO
        function updateGroupStatus(provider, groupId, isOnline) {
            const item = document.getElementById(`group-item-${provider}-${groupId}`);
            if (!item) return;
            
            const statusDot = item.querySelector('.group-status-dot');
            const statusText = item.querySelector('.group-status span');
            
            if (isOnline) {
                statusDot.className = 'group-status-dot online';
                statusText.textContent = 'Conectado';
            } else {
                statusDot.className = 'group-status-dot';
                statusText.textContent = 'Desconectado';
            }
        }

        // ACTUALIZAR ESTADO DE CONEXI칍N
        function setConnectionStatus(connected) {
            state.isConnected = connected;
            
            if (connected) {
                elements.connectionDot.className = 'status-dot online';
                elements.statusText.textContent = 'CONECTADO';
            } else {
                elements.connectionDot.className = 'status-dot';
                elements.statusText.textContent = 'DESCONECTADO';
            }
        }

        // ACTUALIZAR TEXTO DE CARGA
        function updateLoadingText(text) {
            elements.loadingText.textContent = text;
        }

        // MOSTRAR NOTIFICACI칍N
        function showNotification(message, type = 'info') {
            elements.notificationText.textContent = message;
            elements.notification.className = 'notification show';
            
            setTimeout(() => {
                elements.notification.className = 'notification';
            }, 3000);
        }

        // MOSTRAR NOTIFICACI칍N DE NUEVO MENSAJE
        function showNewMessageNotification(provider, groupId, message) {
            const providerName = provider.toUpperCase();
            const sender = message.from?.first_name || 'Usuario';
            const preview = message.text?.substring(0, 50) || 'Nuevo mensaje';
            
            showNotification(`${providerName} G${groupId}: ${sender} - ${preview}...`);
        }

        // APLICAR FILTROS
        function applyFilters() {
            const searchTerm = state.filters.search.toLowerCase();
            const providerFilter = state.filters.provider;
            
            // Filtrar lista de grupos
            document.querySelectorAll('.group-item').forEach(item => {
                const provider = item.dataset.provider;
                const groupName = item.querySelector('.group-name span').textContent.toLowerCase();
                
                const matchesSearch = searchTerm === '' || groupName.includes(searchTerm);
                const matchesProvider = providerFilter === 'all' || providerFilter === provider;
                
                item.style.display = matchesSearch && matchesProvider ? 'flex' : 'none';
            });
            
            // Si hay un grupo activo, filtrar sus mensajes tambi칠n
            if (state.activeGroup) {
                const { provider, groupId } = state.activeGroup;
                const messages = elements.messagesArea.querySelectorAll('.message');
                
                messages.forEach(message => {
                    const messageText = message.textContent.toLowerCase();
                    const matchesSearch = searchTerm === '' || messageText.includes(searchTerm);
                    message.style.display = matchesSearch ? 'block' : 'none';
                });
            }
        }

        // CONFIGURAR EVENT LISTENERS
        function setupEventListeners() {
            // Filtros
            elements.filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (btn.id === 'refresh-btn' || btn.id === 'clear-btn') return;
                    
                    elements.filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    state.filters.provider = btn.dataset.filter;
                    applyFilters();
                });
            });
            
            // B칰squeda
            elements.searchInput.addEventListener('input', () => {
                state.filters.search = elements.searchInput.value;
                applyFilters();
            });
            
            // Actualizar
            elements.refreshBtn.addEventListener('click', () => {
                Object.keys(CONFIG.groups).forEach(provider => {
                    CONFIG.groups[provider].forEach(group => {
                        const key = `${provider}-${group.id}`;
                        if (state.intervals[key]) {
                            clearInterval(state.intervals[key]);
                            startGroupMonitoring(provider, group);
                        }
                    });
                });
                showNotification('Actualizando todos los grupos...');
            });
            
            // Limpiar
            elements.clearBtn.addEventListener('click', () => {
                if (confirm('쯃impiar todos los mensajes?')) {
                    Object.keys(state.messages).forEach(key => {
                        state.messages[key] = [];
                    });
                    
                    state.stats = {
                        total: 0,
                        entel: 0,
                        tigo: 0,
                        viva: 0,
                        diamonds: 0,
                        saldo: 0,
                        lastUpdate: null,
                        connectedGroups: 0,
                        totalGroups: 22
                    };
                    
                    // Resetear contadores de grupos
                    document.querySelectorAll('.message-count').forEach(el => {
                        el.textContent = '0';
                    });
                    
                    // Actualizar estad칤sticas
                    elements.totalMessages.textContent = '0';
                    
                    // Si hay grupo activo, limpiar sus mensajes
                    if (state.activeGroup) {
                        renderActiveGroupMessages(state.activeGroup.provider, state.activeGroup.groupId);
                    }
                    
                    showNotification('Todos los mensajes han sido limpiados');
                }
            });
        }

        // INICIAR AL CARGAR LA P츼GINA
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>